# 更新日志

Galaxy Flow项目所有重要变更将记录在此文件中。

本格式遵循 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/) 标准，
本项目遵循 [语义化版本2.0.0](https://semver.org/lang/zh-CN/spec/v2.0.0.html) 规范。

## [0.10.1] - 2025-08-09

### 新增
- **Galaxy环境初始化**：新增Galaxy平台环境设置功能，支持自动化配置和Galaxy环境初始化
- **网络访问控制服务**：用新的网络访问控制服务替代旧的重定向服务，提供更好的安全性和访问管理
- **构件下载重定向支持**：增加构件下载的重定向功能，提高构件获取的可靠性和灵活性
- **移除gx.artifact功能**：移除旧版gx.artifact能力，推荐使用更灵活的下载替代方案（破坏性变更）
- **项目根目录检测**：新增`GXL_PRJ_ROOT`环境变量用于自动项目根目录发现

### 变更
- **依赖更新**：将`orion_variate`升级到v0.6.2（标签版本），带来增强的变量处理能力和比分支依赖更好的稳定性
- **工作流增强**：升级CI/CD工作流，改进构建和发布流程

### 安全性
- **访问控制增强**：实施网络访问控制服务替代传统重定向服务，改善安全态势和外部服务访问管理

### 修复
- **测试用例**：解决各种测试用例问题，提高测试可靠性
- **代码清理**：移除已弃用的artifact模块和相关解析器代码，降低复杂性和维护负担

## [0.10.0] - 2025-08-07

### 新增
- **增强模板引擎**：支持模板变量（gx.tpl），支持子目录和改进的渲染系统
- **TOML配置支持**：增强TOML文件读取功能，支持改进的解析器和验证（#5）
- **任务系统集成**：全面的任务执行框架，包括：
  - **任务调度和执行**：完整的任务生命周期管理，支持状态跟踪
  - **本地任务报告生成**：自动生成任务执行结果的YAML报告
  - **任务结果持久化**：结构化YAML输出，包含详细执行指标
  - **任务状态同步**：与中央任务管理服务实时同步
  - **试运行功能**：预执行验证，支持`@dryrun`注解和`--dry-run`CLI参数
  - **重试机制**：配置文件加载的自动重试，带有回退策略
  - **任务注解**：丰富的元数据支持（@task、@dryrun注解）
  - **HTTP回调集成**：与任务管理中心的集成
- **输出捕获系统**：标准输出和错误捕获，支持重定向功能
- **GXL环境变量**：支持GXL特定环境变量：
  - `GXL_PRJ_ROOT` 用于项目根目录检测
  - `GXL_CMD_ARG` 用于命令参数处理
  - `GXL_CMD_ARGS`（已弃用） -> `GXL_CMD_ARG`
- **事务支持**：通过`undo_hold`操作增加事务功能和回滚能力
- **WildMatch模式支持**：增加wildmatch库用于高级glob模式匹配
- **命令块语法**：增强命令执行的结构化块语法
- **异步执行引擎**：重构核心引擎使用async/await提高性能

### 变更
- **重构错误处理**：改进系统范围的错误报告，提供更好的错误消息和堆栈跟踪
- **重构流程结构**：现代化流程执行结构，增强异步支持
- **管道语法**：改进流程管道语法，支持更复杂操作
- **配置加载**：增强配置文件加载，支持重试机制和优雅处理

### 已弃用
- **传统重定向服务**：标记为移除，推荐使用网络访问控制服务
- **旧版构件服务**：gx.artifact功能已在v0.10.1版本中移除

### 修复
- **命令环境变量**：修复命令执行中的环境变量传播问题
- **任务配置**：正确处理缺失的任务配置文件或URL
- **日志重定向**：纠正任务执行中的标准输出/错误重定向问题
- **数据格式处理**：修复任务报告中的日期时间格式问题

### 开发者体验
- **增强CLI**：增加`--dry-run`命令行参数用于配置测试
- **更好调试**：当流程不存在时增加警告提示，改进错误消息
- **测试框架**：全面的测试套件添加，包括：
  - 任务系统测试用例
  - 配置加载测试
  - 输出捕获验证
  - 命令执行测试

## [0.9.2-beta.1] - 2024-09-05

之前的稳定版本。此更新日志涵盖从0.9.2-beta.1到0.10.1的变更。

---

**注意**：0.10.x版本相比0.9.x有显著的架构改进，特别是在任务管理、配置处理和系统集成方面。

### 迁移说明
- 环境变量名已标准化。将使用`GXL_CMD_ARG`替代已弃用的`GXL_CMD_ARGS`
- 任务配置文件应更新为新的YAML格式用于任务报告
- 使用新的任务系统时，可参考`examples/task-*.gxl`文件获取配置模式
- 重定向URL的请求头已从传统格式升级为新的访问控制格式
- 旧版本的`undo_flow`已被`undo_hold`替代用于事务操作
- 命令执行语法更新了块结构模式，需要更新现有`.gxl`文件语法

### 升级检查清单
- [ ] 更新环境变量声明从`GXL_CMD_ARGS`到`GXL_CMD_ARG`
- [ ] 检查所有配置文件是否使用YAML格式
- [ ] 验证任务报告URL配置是否适配新格式
- [ ] 测试旧的`.gxl`文件在新版本下的兼容性
- [ ] 确认事务回滚操作使用新的`undo_hold`语法
- [ ] 从gx.artifact迁移：将所有gx.artifact用法替换为gx.download，获得更好的灵活性和控制

---
### 相关Issue链接
- 任务系统设计: #5
- TOML支持: #5
- 输出捕获: #31, #32
- 重定向修复: #35
- CLI错误处理: #46

### 贡献者
特别感谢以下开发者在0.10.x版本周期中的贡献: @wukong, @sec-wukong, @tangxy1024, @tangxiangyan